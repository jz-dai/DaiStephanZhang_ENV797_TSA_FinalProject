---
title: "Prediction for presentation"
author: "Zhang"
date: "2025-04-14"
output: pdf_document
---

```{r chunks, include=FALSE}
#set up chunk options
knitr::opts_chunk$set(echo = TRUE,tidy.opts=list(width.cutoff=80), 
                      tidy=FALSE) 
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
```

```{r libraries, include=FALSE}
#retrieve libraries
library(here)
library(ggplot2)
library(forecast)
library(cowplot)
library(Kendall)
library(tseries)
library(kableExtra)

library(smooth)

set.seed(797)
```

```{r theme, include=FALSE}
#create plot theme
mytheme <- theme_bw(base_size = 10)+
  theme(axis.title = element_text(size = 10, hjust = 0.5),
        plot.title.position = "panel",
        panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.25),
        plot.caption = element_text(hjust = 0),
        legend.box = "vertical",
        legend.location = "plot",
        axis.gridlines = element_line(color = "grey", linewidth = 0.25),
        axis.ticks = element_line(color = "black", linewidth = 0.5),
        axis.grid = element_blank())

#set plot theme
theme_set(mytheme)
```


# Preparation

```{r include=FALSE}
#upload test and training data
methane_train <- read.csv("../Data/Processed/methane_training.csv")
methane_test <- read.csv("../Data/Processed/methane_test.csv")

#create ts object
methane_train_ts <-ts(methane_train$average, 
                start = c(1983,7), 
                end = c(2021, 12), 
                frequency = 12)

methane_test_ts <-ts(methane_test$average, 
                start = c(2022,1), 
                end = c(2024, 12), 
                frequency = 12)

#create msts
methane_train_msts <- msts(methane_train$average, 
                            seasonal.periods =c(4,12),
                            start=c(1983,7)) 

methane_test_msts <- msts(methane_test$average, 
                            seasonal.periods =c(4,12),
                            start=c(2022,1))
```

# Neuron Network

```{r}

NN_fit <- nnetar(methane_train_ts, p = 1, P = 7)

NN_for <- forecast(NN_fit, h=36)

forecast_NN_accuracy <- accuracy(NN_for$mean, methane_test_ts)

print(forecast_NN_accuracy)

plot(NN_for)

```

```{r}

NN_fourier_fit <- nnetar(methane_train_msts, p = 0, P = 7,
                 xreg=fourier(methane_train_msts,K=c(2,6)))

NN_fourier_for <- forecast(NN_fourier_fit, h=36, xreg=fourier(methane_train_msts,K=c(2,6), h=36))

forecast_NN_fourier_accuracy <- accuracy(NN_fourier_for$mean, methane_test_msts)

print(forecast_NN_fourier_accuracy)

plot(NN_fourier_for)

```
## Find the optimal parameter for NN

```{r}
for (i in 0:3){
    for (j in 0:8){
      
      if (i == 0 & j == 0){
        next
      }
      
      NN_fit <- nnetar(methane_train_ts, p = i, P = j)
      
      NN_for <- forecast(NN_fit, h=36)
      
      forecast_NN_accuracy <- accuracy(NN_for$mean, methane_test_ts)
      
      
      cat("p=",i,"P=",j,"\n")
      print(forecast_NN_accuracy)
      
      
    }
}


```

## Find the optimal parameter for NN w/fourier

```{r}

for (i in 0:2){
    for (j in 0:8){
      
      if (i == 0 & j == 0){
        next
      }
      
      NN_fourier_fit <- nnetar(methane_train_msts, p = i, P = j,
                 xreg=fourier(methane_train_msts,K=c(2,6)))

      NN_fourier_for <- forecast(NN_fourier_fit, h=36, xreg=fourier(methane_train_msts,K=c(2,6), h=36))

      forecast_NN_fourier_accuracy <- accuracy(NN_fourier_for$mean, methane_test_msts)
      
      cat("p=",i,"P=",j,"\n")
      print(forecast_NN_fourier_accuracy)
      
    }
}

  


```

# State Space

```{r}

SSES <- es(methane_train_ts,model="ZZZ",h=36,holdout=FALSE)

forecast_SSES_accuracy <- accuracy(SSES$forecast, methane_test_ts)

print(forecast_SSES_accuracy)


```


